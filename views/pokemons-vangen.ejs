<!DOCTYPE html>
<html lang="nl-BE">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="/assets/pokemonICO.ico" type="image/x-icon">
  <title>Pokémon vangen</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="styles/reset.css">
  <link rel="stylesheet" href="styles/style.css">
  <link rel="stylesheet" href="styles/_media_queries.css">
  <!--SCRIPTS-->
  <script src="https://kit.fontawesome.com/cd8c9527e1.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script defer src="/scripts/general.js"></script>
  <script defer src="/scripts/currentpokemon.js"></script>
  <script defer src="/scripts/vangen.js"></script>
</head>

<body class="ingelogd">
  <header>
    <nav>
      <section class="left-container">
        <a href="/pokemon-submenu"><img src="/assets/pokemon_logo.png" alt="logo"></a>
      </section>
      <section id="nav-menus" class="nav-container">
        <ul class="">
          <li><abbr title="Pokémons&nbsp;bekijken"><a href="/pokemons-bekijken"><img
                  src="/assets/nav-icons-black/bekijken.png" alt=""></a></abbr></li>
          <li><abbr title="Pokémons&nbsp;vergelijken"><a href="/pokemon-vergelijken"><img
                  src="/assets/nav-icons-black/vergelijken.png" alt=""></a></abbr></li>
          <li class="active"><abbr title="Pokémons&nbsp;vangen"><a href="/pokemons-vangen"><img
                  src="/assets/nav-icons-red/vangen.png" alt=""></a></abbr></li>
          <li><abbr title="Huidige&nbsp;pokémon"><a href="/huidige-pokemon"><img
                  src="/assets/nav-icons-black/huidige.png" alt=""></a></abbr>
          </li>
          <li><abbr title="Pokémon&nbsp;battler"><a href="/pokemon-battler"><img
                  src="/assets/nav-icons-black/battler.png" alt=""></a></abbr>
          </li>
          <li><abbr title="Wie&nbsp;is&nbsp;deze&nbsp;pokémon?"><a href="/who's-that-pokemon"><img
                  src="/assets/nav-icons-black/who.png" alt=""></a></abbr>
          </li>
          <li><abbr title="Pokémons&nbsp;tracker"><a href="/pokemon-finder"><img
                  src="/assets/nav-icons-black/tracker.png" alt=""></a></abbr>
          </li>
        </ul>
      </section>
      <section class="right-container">
        <ul>
          <li class="hamMenu"><button class="btn btn-dark"><i class="fa-solid fa-bars"></i></button></li>
          <li><a href="#" data-bs-toggle="modal" data-bs-target="#chooseAvatar"><button>
                <% if (avatar) {%>
                  <img src="<%= avatar %>" alt="my-avatar">
                  <% } else { %>
                    <i class="fa-solid fa-question"></i>
                    <% } %>
              </button></a></li>
          <li><a href="/pokemon-auth/logout" class="fa-solid fa-right-from-bracket btn btn-dark"></a>
          </li>
        </ul>
      </section>
    </nav>
  </header>
  <main>
    <section class="pokemon_hide">
      <img src="/assets/pokemon_logo.png" alt="">
      <img src="/assets/pokeball_opening.gif" alt="">
    </section>
    <section class="current-pokemon">
      <a href="/huidige-pokemon">
        <% if (currentPokemon.pokemonGif) { %>
          <img class="pokemon-pic" src="<%= currentPokemon.pokemonGif %>" alt="<%= currentPokemon.pokemonName %>">
          <% } else { %>
            <img class="pokemon-pic" src="<%= currentPokemon.pokemonImg %>" alt="<%= currentPokemon.pokemonName %>">
            <% } %>
      </a>
      <img class="pokemon_podioum" src="assets/podium.png" alt="pokemon-podium">
      <section class="pokemon-stats">
        <section class="pokemon-hp">
          <img id="life" src="assets/red-heart.png" alt="leven">
          <p>
            <%= currentPokemon.pokemonHP %>
          </p>
        </section>
        |
        <section class="pokemon-shield">
          <img id="shield" src="assets/shield.png" alt="verdediging">
          <p>
            <%= currentPokemon.pokemonDefense %>
          </p>
        </section>
      </section>
    </section>
    <section class="poke-catch">
      <article class="roulette-container">
        <span class="roulette-arrow">&darr;</span>
        <ul class="roulette-box">
          <li class="one">1</li>
          <li class="two">2</li>
          <li class="three">3</li>
          <li class="four">4</li>
          <li class="five">5</li>
          <li class="six">6</li>
          <li class="seven">7</li>
          <li class="eight">8</li>
        </ul>
      </article>
      <article>
        <div id="countdown-container">
          <!--zandloper-->
          <img id="hourglass" src="" alt="">
          <p id="countdown"></p>
          <p id="poke-title">

          </p>
        </div>
        <!-- arrow verdwijnt vanaf 800px -->
        <a class="poke-catch-container" href=""><img class="poke-catch-img hover-animation" src="/assets/pokemon.png"
            alt="te-vangen"></a>
      </article>
      <img class="boxing-gloves" src="/assets/box-gloves.png" alt="">
      <article class="poke-catch-buttons">
        <button onclick="" id="catch-button" type="button"><img src="/assets/scoop-net.png" alt="net"></button>
        <a href="#">
          <img class="poke-catch-ball" src="/assets/pokemon_logo.png"> <!--Loslaten-->
        </a>
      </article>
    </section>

    <!-- Modal voor help-->
    <section class="modal fade" id="hulp" tabindex="-1" aria-labelledby="hulpLabel" aria-hidden="true">
      <section class="modal-dialog modal-dialog-centered">
        <section class="modal-content">
          <section class="modal-header">
            <h1 class="modal-title fs-5" id="hulpLabel">Hulp</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </section>
          <section class="modal-body">
            Op deze pagina krijgt u een willekeurige Pokémon te zien door op het vangnet te drukken. Na het drukken
            wordt er een Pokémon gegenereerd en moet u 8 seconden wachten. <br>
            Als de rand van de pokébal <span style="color: green; font-weight:bolder;">groen</span> is, betekent dit dat
            u de Pokémon niet kunt vangen en een keuze moet maken om deze vrij te laten of een andere proberen te vangen
            door weer op de vangnet te drukken. <br>
            Als de rand van de Pokébal <span style="color: red; font-weight:bolder;">rood</span> is,
            betekent dit dat u de Pokémon kunt proberen te vangen. U krijgt 3 pogingen. Als u de Pokémon niet vangt
            binnen deze pogingen, sluit het venster. <br>
          </section>
        </section>
      </section>
    </section>
    <!-- Modal voor keuze-->
    <form action="/pokemons-vangen/loslaten" method="post">
      <input type="hidden" id="sendPokeName" name="sendPokeName" value="">
      <section class="modal fade" id="loslaten" tabindex="-1" aria-labelledby="loslatenLabel" aria-hidden="true">
        <section class="modal-dialog modal-dialog-centered">
          <section class="modal-content">
            <section class="modal-header">
              <h1 class="modal-title fs-5" id="loslatenLabel">Wil je die loslaten?</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </section>
            <section class="modal-body bg-dark">
              <section class="d-grid gap-2 mb-2">
                <button class="btn btn-success" type="submit">Ja</button>
                <button data-bs-dismiss="modal" class="btn btn-danger" type="button">Nee</button>
              </section>
            </section>
          </section>
        </section>
      </section>
    </form>
    <!--Modal vangen-->
    <form action="/pokemons-vangen/vangen" method="post">
      <section class="modal fade" id="vangen" tabindex="-1" aria-labelledby="vangenLabel" aria-hidden="true">
        <section class="modal-dialog modal-dialog-centered">
          <section class="modal-content">
            <section class="modal-header">
              <h1 class="modal-title fs-5" id="vangenLabel">Vang de pokemon!</h1>
            </section>
            <section class="modal-body bg-dark">
              <section class="d-grid gap-2 mb-2">
                <section>
                  <section class="full-HP-modal">
                    <input type="hidden" id="killedPoke" name="killedPoke">
                    <p id="poke-name" style="color: white;"></p>
                    <ul class="modal-HP-damage">
                      <li style="margin: auto;"><img src="/assets/red-heart.png" style="margin: auto; width: 30px; margin-right: 10px;"  alt="HP"></li>
                      <li style="color: white;"><span id="HPModalNumber"></span>/<span id="randomDamage"></span> <img src="/assets/damage.gif" width="40px"></li>
                    </ul>
                  </section>
                  <div class="vang-container-img"><img src="" id="poke-img-modal" alt=""></div>
                </section>
                <button class="btn btn-light" id="catch-btn-toDB" type="submit">Vang!</button>
                <a class="btn btn-light" id="catch-btn-tryAgain">Probeer nog eens!</a>
              </section>
            </section>
          </section>
        </section>
      </section>
    </form>
    <!-- Modal voor avatar-->
    <section class="modal fade" id="chooseAvatar" tabindex="-1" aria-labelledby="chooseAvatar" aria-hidden="true">
      <section class="modal-dialog modal-dialog-centered">
        <section class="modal-content">
          <section class="modal-header">
            <h1 class="modal-title fs-5" id="chooseAvatarLabel">Kies je nieuwe avatar</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </section>
          <section class="modal-body">
            <ul class="avatars">
              <li onclick="changeAvatar('ash')"><img src="/assets/avatars/ash_ketchum.png" alt="ash"></li>
              <li onclick="changeAvatar('chloe')"><img src="/assets/avatars/chloe.png" alt="chloe"></li>
              <li onclick="changeAvatar('dawn')"><img src="/assets/avatars/dawn.png" alt="dawn"></li>
              <li onclick="changeAvatar('james')"><img src="/assets/avatars/james.png" alt="james"></li>
              <li onclick="changeAvatar('jessie')"><img src="/assets/avatars/jessie.png" alt="jessie"></li>
              <li onclick="changeAvatar('may')"><img src="/assets/avatars/may.png" alt="may"></li>
              <li onclick="changeAvatar('serena')"><img src="/assets/avatars/serena.png" alt="serena"></li>
              <li onclick="changeAvatar('none')"><img src="/assets/avatars/none.png" alt="none"></li>
            </ul>
          </section>
        </section>
      </section>
    </section>
    <section data-bs-toggle="modal" data-bs-target="#hulp" class="help"><button><i
          class="fa-solid fa-question"></i></button></section>
  </main>
  <script>


    ///////////////////////////////////////////////////////////////////////////////
    //-----------------------WILLEKEURIGE AFBEELDINGEN--------------------------//

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min)) + min;
    }

    function generateRandomPokemonDataUrl() {
      const randomPokemonId = getRandomInt(1, 101);
      return `https://pokeapi.co/api/v2/pokemon/${randomPokemonId}`;
    }

    const imageElements = document.getElementsByClassName('poke-catch-img');
    const titleElement = document.getElementById('poke-title');
    const countdownElement = document.getElementById('countdown');
    const hourglassElement = document.getElementById('hourglass');
    const rouletteElement = document.getElementsByClassName('roulette-box')[0];
    const catchElement = document.getElementById('catch-button');
    let count = 8;
    const linkElement = document.getElementsByClassName('poke-catch-container')[0];
    const releaseModal = new bootstrap.Modal(document.getElementById('loslaten'), {
      keyboard: false
    });
    const catchModal = new bootstrap.Modal(document.getElementById('vangen'), { keyboard: false, backdrop: 'static' });
    const pokeImgModal = document.getElementById('poke-img-modal');
    const pokeBallElement = document.getElementsByClassName('poke-catch-ball')[0];
    const sendPokeNameElement = document.getElementById('sendPokeName');
    const pokeNameModal = document.getElementById('poke-name');
    const HPModalNumber = document.getElementById('HPModalNumber');
    const randomDamageElement = document.getElementById('randomDamage');
    const btnSendToDB = document.getElementById('catch-btn-toDB');
    const btnTryAgain = document.getElementById('catch-btn-tryAgain');
    const killedPokeElement = document.getElementById('killedPoke');


    function generateRandomNumber() {
      // Genereren van een willekeurig getal tussen 1 en 255
      let randomNumber = Math.floor(Math.random() * 100) + 1;
      return randomNumber;
    }



    // Functie om elke seconde een nieuwe willekeurige afbeelding en titel weer te geven
    async function changeImageAndTitle() {
      const interval = setInterval(async () => {
        const pokemonDataUrl = generateRandomPokemonDataUrl();
        try {
          const response = await fetch(pokemonDataUrl);
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          const pokemonData = await response.json();
          const imageUrl = pokemonData.sprites.other['official-artwork'].front_default;
          const pokemonName = pokemonData.name;
          const HPModal = pokemonData.stats[0].base_stat;
          Array.from(imageElements).forEach((element) => {
            element.src = imageUrl;
          });
          if (count <= 0) {
            clearInterval(interval);
            countdownElement.style.display = 'none';
          }
          if (count === 0) {
            hourglassElement.style.display = 'none';
            rouletteElement.style.animation = 'none';
            titleElement.innerText = pokemonName;
            pokeNameModal.innerText = pokemonName;
            killedPokeElement.value = pokeNameModal.innerText;
            pokeImgModal.src = imageUrl;
            HPModalNumber.innerText = HPModal;

            /// Toon het willekeurige getal in het element
            let counter = 0;
            let randomNumber = generateRandomNumber();
            randomDamageElement.textContent = randomNumber;

            btnTryAgain.addEventListener('click', function () {
              counter++;
              randomNumber = generateRandomNumber();
              randomDamageElement.textContent = randomNumber;

              // Controleer direct na elke klik of counter gelijk is aan 3
              if (counter === 3) {
                catchModal.hide();
                window.location.reload();
              }

              // Update de display logica na elke klik
              if (HPModal > randomNumber) {
                btnSendToDB.style.display = 'none';
                btnTryAgain.style.display = 'block';
              } else {
                btnSendToDB.style.display = 'block';
                btnTryAgain.style.display = 'none';
              }
            });

            // Controleer initiële logica bij laden van de modal
            if (HPModal > randomNumber) {
              btnSendToDB.style.display = 'none';
              btnTryAgain.style.display = 'block';
            } else {
              btnSendToDB.style.display = 'block';
              btnTryAgain.style.display = 'none';
            }

            let pokemonsArray = <%- JSON.stringify(userPokeArray) %>;
            // Initialiseer een leeg array om de pokemons zonder Pikachu op te slaan
            let pikachulessArray = pokemonsArray.filter(function (pokemon) {
              return pokemon.pokemonName !== 'Pikachu';
            });

            for (let i = 0; i < pikachulessArray.length; i++) {
              if (pikachulessArray[i].pokemonName === pokemonName) {
                console.log('pokemon already in array');
                // Als de naam overeenkomt, maak de rand van de poke-catch-ball groen
                document.querySelector('.poke-catch-ball').style.border = '5px solid limegreen';
                pokeBallElement.addEventListener('click', function () {
                  releaseModal.show();
                });
                sendPokeNameElement.value = pokemonName;
                console.log(sendPokeNameElement.value);
              }
              else {
                console.log('pokemon not in array');
                // Zo niet, maak de rand van de poke-catch-ball rood
                document.querySelector('.poke-catch-ball').style.border = '5px solid red';
                pokeBallElement.addEventListener('click', function () {
                  catchModal.show();
                });
              }
            }
          }
          countdownElement.innerText = count;
          count--;

        } catch (error) {
          console.error('Error fetching data:', error);
        }
      }, 1000);
    }

    catchElement.addEventListener('mouseover', function () {
      if (catchElement.classList.contains('clicked')) {
        catchElement.style.animation = 'swing 1s infinite';
      }
      else {
        catchElement.style.animation = 'swing 1s infinite';
      }
    });

    catchElement.addEventListener('mouseout', function () {
      catchElement.style.animation = 'none';
    });



    catchElement.addEventListener('click', function (event) {
      event.preventDefault();
      linkElement.style.pointerEvents = 'none';
      catchElement.style.animation = 'catch 1s';
      titleElement.innerText = '';
      hourglassElement.src = '../assets/hourglass.gif';
      hourglassElement.alt = 'Hourglass Image';
      hourglassElement.style.animation = 'spin 2s linear infinite';
      rouletteElement.style.animation = 'spin 9s linear infinite';
      count = 8;
      countdownElement.innerText = count;
      countdownElement.style.display = 'block';
      changeImageAndTitle();
      hourglassElement.style.display = 'block';
      catchElement.classList.add('clicked');
    });
  </script>

</body>

</html>