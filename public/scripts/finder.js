const NUM_BUSHES_PC=3e3,NUM_BUSHES_MOBILE=1e3,NUM_BALLS=5,hideHelp=document.getElementById("hideHelp"),player=document.querySelector(".player"),player_pos={x:parseInt(window.innerWidth/2),y:parseInt(window.innerHeight/2)},player_vel={x:0,y:0},balls=[];let walking=new Audio("../assets/finder-files/walking.ogg"),battleSound=new Audio("../assets/finder-files/tension_sound.ogg");const mainTag=document.querySelector("main");var joy=new JoyStick("joyDiv");function handleJoystickMovement(){var e=joy.GetDir();switch(e){case"N":player_vel.y=.5,player.style.backgroundImage='url("../assets/finder-files/player_front.png")',player.classList.add("active");break;case"NE":player_vel.y=.5,player_vel.x=.5,player.style.backgroundImage='url("../assets/finder-files/player_front.png")',player.classList.add("active");break;case"E":player_vel.x=.5,player.style.backgroundImage='url("../assets/finder-files/player_right.png")',player.classList.add("active");break;case"SE":player_vel.y=-.5,player_vel.x=.5,player.style.backgroundImage='url("../assets/finder-files/player_back.png")',player.classList.add("active");break;case"S":player_vel.y=-.5,player.style.backgroundImage='url("../assets/finder-files/player_back.png")',player.classList.add("active");break;case"SW":player_vel.y=-.5,player_vel.x=-.5,player.style.backgroundImage='url("../assets/finder-files/player_back.png")',player.classList.add("active");break;case"W":player_vel.x=-.5,player.style.backgroundImage='url("../assets/finder-files/player_left.png")',player.classList.add("active");break;case"NW":player_vel.y=.5,player_vel.x=-.5,player.style.backgroundImage='url("../assets/finder-files/player_front.png")',player.classList.add("active");break;default:player_vel.x=0,player_vel.y=0,player.classList.remove("active")}}function createBushes(){let e=document.querySelector("main");if(window.innerWidth<=800){document.body.style.backgroundSize="cover",document.querySelector("#joyDiv").style.visibility="visible";for(let a=0;a<1e3;a++){let l=document.createElement("div");l.classList.add("bush"),l.style.left=Math.max(1,Math.random()*(window.innerWidth-50))+"px",l.style.top=Math.max(10,Math.random()*(window.innerHeight-110))+"px",e.appendChild(l)}}else for(let r=0;r<3e3;r++){let t=document.createElement("div");t.classList.add("bush"),t.style.left=Math.max(1,Math.random()*(window.innerWidth-55))+"px",t.style.top=Math.max(10,Math.random()*(window.innerHeight-100))+"px",e.appendChild(t)}}function generateBall(){if(balls.length<5){let e=document.createElement("div");e.classList.add("pokeball"),e.style.position="absolute";let a=window.innerWidth-50,l=window.innerHeight-110,r=Math.max(Math.min(1,a),Math.random()*a)+"px",t=Math.max(Math.min(10,l),Math.random()*l)+"px";e.style.left=r,e.style.top=t,balls.push({ball:e,pos:{x:r,y:t}}),mainTag.appendChild(e)}}function createBalls(){for(let e=0;e<5;e++)generateBall()}function collision(e,a){var l=e.getBoundingClientRect(),r=a.getBoundingClientRect(),t=l.left,s=l.top,n=l.height,i=l.width,o=r.left,d=r.top,p=r.height,y=r.width;return!(s+n<d)&&!(s>d+p)&&!(t+i<o)&&!(t>o+y)}async function getRandomPokemon(){let e=document.getElementById("randomPokemonName"),a=document.getElementById("randomPokemonImage"),l=document.getElementById("randomPokemonID");e.innerText="",a.src="",l.href="",await fetch("/pokemon-finder/random-pokemon",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(r=>{e.innerText=r.pokeNaam,l.href=`/pokemon-battler-vs-pc/${r.pokeNaam.toLowerCase()}`,a.src=r.pokeURL,modal.show()}).catch(e=>{console.error("Error:",e)})}let modal=new bootstrap.Modal(document.getElementById("pokemonFinder"),{keyboard:!1,backdrop:"static"});function checkCollisions(){balls.forEach((e,a)=>{collision(e.ball,player)&&(e.ball.remove(),balls.splice(a,1),generateBall(),getRandomPokemon())})}function playSound(e){var a=function(){var a=e.play();void 0!==a&&a.then(e=>{}).catch(e=>{console.error("Autoplay prevented:",e)}),e.loop=!0},l=function(){document.removeEventListener("click",l),document.removeEventListener("touchstart",l),a()};document.interactionListener?a():(document.addEventListener("click",l),document.addEventListener("touchstart",l),document.interactionListener=!0)}function stopSound(e){var a=e.pause();e.currentTime=0,void 0!==a&&a.then(e=>{}).catch(a=>{e.currentTime=0,e.pause()})}function run(){player_pos.x+=player_vel.x,player_pos.y+=player_vel.y,0!==player_vel.x||0!==player_vel.y?playSound(walking):stopSound(walking),player_pos.x<0?player_pos.x=0:player_pos.x>window.innerWidth-player.offsetWidth&&(player_pos.x=window.innerWidth-player.offsetWidth),player_pos.y<0?player_pos.y=0:player_pos.y>window.innerHeight-player.offsetHeight&&(player_pos.y=window.innerHeight-player.offsetHeight),player.style.left=player_pos.x+"px",player.style.bottom=player_pos.y+"px",checkCollisions(),requestAnimationFrame(run)}function init(){createBushes(),createBalls(),run()}init(),window.innerWidth<=800&&setInterval(handleJoystickMovement,20),modal._element.addEventListener("hidden.bs.modal",()=>{stopSound(walking),stopSound(battleSound)}),modal._element.addEventListener("shown.bs.modal",()=>{playSound(battleSound)});const keysPressed=new Set;window.addEventListener("keydown",function(e){keysPressed.add(e.key),modal&&modal._element.classList.contains("show")?(player_vel.x=0,player_vel.y=0):(keysPressed.has("ArrowUp")&&(player_vel.y=.75,player.style.backgroundImage='url("../assets/finder-files/player_front.png")'),keysPressed.has("ArrowDown")&&(player_vel.y=-.75,player.style.backgroundImage='url("../assets/finder-files/player_back.png")'),keysPressed.has("ArrowLeft")&&(player_vel.x=-.75,player.style.backgroundImage='url("../assets/finder-files/player_left.png")'),keysPressed.has("ArrowRight")&&(player_vel.x=.75,player.style.backgroundImage='url("../assets/finder-files/player_right.png")'),player.classList.add("active"))}),window.addEventListener("keyup",function(e){keysPressed.delete(e.key),keysPressed.has("ArrowUp")||keysPressed.has("ArrowDown")||(player_vel.y=0),keysPressed.has("ArrowLeft")||keysPressed.has("ArrowRight")||(player_vel.x=0),0===keysPressed.size&&player.classList.remove("active")}),window.addEventListener("resize",function(){location.reload()});let hulpModal=new bootstrap.Modal(document.getElementById("hulp"),{keyboard:!1});window.onload=function(){("false"===localStorage.getItem("hideHelp")||null===localStorage.getItem("hideHelp"))&&hulpModal.show()},hideHelp.addEventListener("change",function(){localStorage.setItem("hideHelp",hideHelp.checked)});